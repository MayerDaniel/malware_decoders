'''
Written by Jason Reaves - @sysopfb
Free to use, attribute properly.

'''
import re
import yara
import sys


def decoder(data):
	doms = []
	version = None
	post_val = None
	t = re.findall('''AZ\x00\x00KZ\x00\x00UZ\x00\x00BY\x00\x00RU\x00\x00[\x00-\xff]{50}''', data)
	test = t[0].split('\x00')
	test = [x for x in test if len(x) >2]
	if len(test) > 1:
		dom1 = bytearray(test[0])
		key1 = bytearray(test[1])
		for i in range(len(dom1)):
			dom1[i] ^= key1[i%len(key1)]
		doms.append(str(dom1))
		test = test[2:]
		for val in test:
			if len(val) > 2 and '.' in val:
				version = val
			elif re.match('''^\d+$''', val):
				post_val = val

	return({'c2s': ','.join(doms), 'version': str(version), 'uri': str(post_val)})


if __name__ == "__main__":
	data = open(sys.argv[1], 'rb').read()
	t = decoder(data)
	print(t)
